//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/nicolasmenard/IdeaProjects/RTDC/core/src/main/java/rtdc/core/json/JSONWriter.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "JSONException.h"
#include "JSONObject.h"
#include "JSONWriter.h"
#include "java/io/IOException.h"
#include "java/io/Writer.h"
#include "java/lang/Long.h"

#define JSONJSONWriter_maxdepth 20

@interface JSONJSONWriter () {
 @public
  jboolean comma_;
  IOSCharArray *stack_;
  jint top_;
}

- (JSONJSONWriter *)appendWithNSString:(NSString *)s;

- (JSONJSONWriter *)endWithChar:(jchar)m
                       withChar:(jchar)c;

- (void)popWithChar:(jchar)c;

- (void)pushWithChar:(jchar)c;

@end

J2OBJC_FIELD_SETTER(JSONJSONWriter, stack_, IOSCharArray *)

J2OBJC_STATIC_FIELD_GETTER(JSONJSONWriter, maxdepth, jint)

__attribute__((unused)) static JSONJSONWriter *JSONJSONWriter_appendWithNSString_(JSONJSONWriter *self, NSString *s);

__attribute__((unused)) static JSONJSONWriter *JSONJSONWriter_endWithChar_withChar_(JSONJSONWriter *self, jchar m, jchar c);

__attribute__((unused)) static void JSONJSONWriter_popWithChar_(JSONJSONWriter *self, jchar c);

__attribute__((unused)) static void JSONJSONWriter_pushWithChar_(JSONJSONWriter *self, jchar c);

@implementation JSONJSONWriter

- (instancetype)initWithJavaIoWriter:(JavaIoWriter *)w {
  JSONJSONWriter_initWithJavaIoWriter_(self, w);
  return self;
}

- (JSONJSONWriter *)appendWithNSString:(NSString *)s {
  return JSONJSONWriter_appendWithNSString_(self, s);
}

- (JSONJSONWriter *)array {
  if (self->mode_ == 'i' || self->mode_ == 'o' || self->mode_ == 'a') {
    JSONJSONWriter_pushWithChar_(self, 'a');
    JSONJSONWriter_appendWithNSString_(self, @"[");
    self->comma_ = false;
    return self;
  }
  @throw [new_JSONJSONException_initWithNSString_(@"Misplaced array.") autorelease];
}

- (JSONJSONWriter *)endWithChar:(jchar)m
                       withChar:(jchar)c {
  return JSONJSONWriter_endWithChar_withChar_(self, m, c);
}

- (JSONJSONWriter *)endArray {
  return JSONJSONWriter_endWithChar_withChar_(self, 'a', ']');
}

- (JSONJSONWriter *)endObject {
  return JSONJSONWriter_endWithChar_withChar_(self, 'k', '}');
}

- (JSONJSONWriter *)keyWithNSString:(NSString *)s {
  if (s == nil) {
    @throw [new_JSONJSONException_initWithNSString_(@"Null key.") autorelease];
  }
  if (self->mode_ == 'k') {
    @try {
      if (self->comma_) {
        [((JavaIoWriter *) nil_chk(self->writer_)) writeWithInt:','];
      }
      [((JavaIoWriter *) nil_chk(self->writer_)) writeWithNSString:JSONJSONObject_quoteWithNSString_(s)];
      [self->writer_ writeWithInt:':'];
      self->comma_ = false;
      self->mode_ = 'o';
      return self;
    }
    @catch (JavaIoIOException *e) {
      @throw [new_JSONJSONException_initWithJavaLangThrowable_(e) autorelease];
    }
  }
  @throw [new_JSONJSONException_initWithNSString_(@"Misplaced key.") autorelease];
}

- (JSONJSONWriter *)object {
  if (self->mode_ == 'i') {
    self->mode_ = 'o';
  }
  if (self->mode_ == 'o' || self->mode_ == 'a') {
    JSONJSONWriter_appendWithNSString_(self, @"{");
    JSONJSONWriter_pushWithChar_(self, 'k');
    self->comma_ = false;
    return self;
  }
  @throw [new_JSONJSONException_initWithNSString_(@"Misplaced object.") autorelease];
}

- (void)popWithChar:(jchar)c {
  JSONJSONWriter_popWithChar_(self, c);
}

- (void)pushWithChar:(jchar)c {
  JSONJSONWriter_pushWithChar_(self, c);
}

- (JSONJSONWriter *)valueWithBoolean:(jboolean)b {
  return JSONJSONWriter_appendWithNSString_(self, b ? @"true" : @"false");
}

- (JSONJSONWriter *)valueWithLong:(jlong)l {
  return JSONJSONWriter_appendWithNSString_(self, JavaLangLong_toStringWithLong_(l));
}

- (JSONJSONWriter *)valueWithId:(id)o {
  return JSONJSONWriter_appendWithNSString_(self, JSONJSONObject_valueToStringWithId_(o));
}

- (void)dealloc {
  RELEASE_(stack_);
  RELEASE_(writer_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaIoWriter:", "JSONWriter", NULL, 0x1, NULL, NULL },
    { "appendWithNSString:", "append", "Lrtdc.core.json.JSONWriter;", 0x2, "Lrtdc.core.json.JSONException;", NULL },
    { "array", NULL, "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "endWithChar:withChar:", "end", "Lrtdc.core.json.JSONWriter;", 0x2, "Lrtdc.core.json.JSONException;", NULL },
    { "endArray", NULL, "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "endObject", NULL, "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "keyWithNSString:", "key", "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "object", NULL, "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "popWithChar:", "pop", "V", 0x2, "Lrtdc.core.json.JSONException;", NULL },
    { "pushWithChar:", "push", "V", 0x2, "Lrtdc.core.json.JSONException;", NULL },
    { "valueWithBoolean:", "value", "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "valueWithLong:", "value", "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
    { "valueWithId:", "value", "Lrtdc.core.json.JSONWriter;", 0x1, "Lrtdc.core.json.JSONException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "maxdepth", "maxdepth", 0x1a, "I", NULL, NULL, .constantValue.asInt = JSONJSONWriter_maxdepth },
    { "comma_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "mode_", NULL, 0x4, "C", NULL, NULL, .constantValue.asLong = 0 },
    { "stack_", NULL, 0x2, "[C", NULL, NULL, .constantValue.asLong = 0 },
    { "top_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "writer_", NULL, 0x4, "Ljava.io.Writer;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _JSONJSONWriter = { 2, "JSONWriter", "rtdc.core.json", NULL, 0x1, 13, methods, 6, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_JSONJSONWriter;
}

@end

void JSONJSONWriter_initWithJavaIoWriter_(JSONJSONWriter *self, JavaIoWriter *w) {
  NSObject_init(self);
  self->comma_ = false;
  self->mode_ = 'i';
  JreStrongAssignAndConsume(&self->stack_, [IOSCharArray newArrayWithLength:JSONJSONWriter_maxdepth]);
  self->top_ = 0;
  JreStrongAssign(&self->writer_, w);
}

JSONJSONWriter *new_JSONJSONWriter_initWithJavaIoWriter_(JavaIoWriter *w) {
  JSONJSONWriter *self = [JSONJSONWriter alloc];
  JSONJSONWriter_initWithJavaIoWriter_(self, w);
  return self;
}

JSONJSONWriter *JSONJSONWriter_appendWithNSString_(JSONJSONWriter *self, NSString *s) {
  if (s == nil) {
    @throw [new_JSONJSONException_initWithNSString_(@"Null pointer") autorelease];
  }
  if (self->mode_ == 'o' || self->mode_ == 'a') {
    @try {
      if (self->comma_ && self->mode_ == 'a') {
        [((JavaIoWriter *) nil_chk(self->writer_)) writeWithInt:','];
      }
      [((JavaIoWriter *) nil_chk(self->writer_)) writeWithNSString:s];
    }
    @catch (JavaIoIOException *e) {
      @throw [new_JSONJSONException_initWithJavaLangThrowable_(e) autorelease];
    }
    if (self->mode_ == 'o') {
      self->mode_ = 'k';
    }
    self->comma_ = true;
    return self;
  }
  @throw [new_JSONJSONException_initWithNSString_(@"Value out of sequence.") autorelease];
}

JSONJSONWriter *JSONJSONWriter_endWithChar_withChar_(JSONJSONWriter *self, jchar m, jchar c) {
  if (self->mode_ != m) {
    @throw [new_JSONJSONException_initWithNSString_(m == 'o' ? @"Misplaced endObject." : @"Misplaced endArray.") autorelease];
  }
  JSONJSONWriter_popWithChar_(self, m);
  @try {
    [((JavaIoWriter *) nil_chk(self->writer_)) writeWithInt:c];
  }
  @catch (JavaIoIOException *e) {
    @throw [new_JSONJSONException_initWithJavaLangThrowable_(e) autorelease];
  }
  self->comma_ = true;
  return self;
}

void JSONJSONWriter_popWithChar_(JSONJSONWriter *self, jchar c) {
  if (self->top_ <= 0 || IOSCharArray_Get(nil_chk(self->stack_), self->top_ - 1) != c) {
    @throw [new_JSONJSONException_initWithNSString_(@"Nesting error.") autorelease];
  }
  self->top_ -= 1;
  self->mode_ = self->top_ == 0 ? 'd' : IOSCharArray_Get(nil_chk(self->stack_), self->top_ - 1);
}

void JSONJSONWriter_pushWithChar_(JSONJSONWriter *self, jchar c) {
  if (self->top_ >= JSONJSONWriter_maxdepth) {
    @throw [new_JSONJSONException_initWithNSString_(@"Nesting too deep.") autorelease];
  }
  *IOSCharArray_GetRef(nil_chk(self->stack_), self->top_) = c;
  self->mode_ = c;
  self->top_ += 1;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(JSONJSONWriter)
