//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/nicolasmenard/IdeaProjects/RTDC/core/src/main/java/rtdc/core/controller/AddActionController.java
//

#include "Action.h"
#include "AddActionController.h"
#include "AddActionView.h"
#include "Cache.h"
#include "Controller.h"
#include "Event.h"
#include "EventType.h"
#include "FetchUnitsEvent.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "Service.h"
#include "Stringifier.h"
#include "UiDropdown.h"
#include "UiElement.h"
#include "Unit.h"
#include "com/google/common/collect/ImmutableSet.h"
#include "java/util/ArrayList.h"
#include "java/util/Date.h"

@interface ControllerAddActionController () {
 @public
  JavaUtilArrayList *units_;
  ModelAction *currentAction_;
}

@end

J2OBJC_FIELD_SETTER(ControllerAddActionController, units_, JavaUtilArrayList *)
J2OBJC_FIELD_SETTER(ControllerAddActionController, currentAction_, ModelAction *)

@interface ControllerAddActionController_$1 : NSObject < UtilStringifier >

- (NSString *)toStringWithId:(ModelUnit *)unit;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(ControllerAddActionController_$1)

__attribute__((unused)) static void ControllerAddActionController_$1_init(ControllerAddActionController_$1 *self);

__attribute__((unused)) static ControllerAddActionController_$1 *new_ControllerAddActionController_$1_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ControllerAddActionController_$1)

@implementation ControllerAddActionController

- (instancetype)initWithViewAddActionView:(id<ViewAddActionView>)view {
  ControllerAddActionController_initWithViewAddActionView_(self, view);
  return self;
}

- (NSString *)getTitle {
  return @"Add Action";
}

- (void)addAction {
  ModelAction *action = new_ModelAction_init();
  if (currentAction_ != nil) [action setIdWithInt:[currentAction_ getId]];
  [action setTaskWithModelAction_TaskEnum:[((id<ImplUiDropdown>) nil_chk([((id<ViewAddActionView>) nil_chk(view_)) getTaskUiElement])) getValue]];
  [action setRoleResponsibleWithNSString:[((id<ImplUiElement>) nil_chk([((id<ViewAddActionView>) view_) getRoleUiElement])) getValue]];
  [action setTargetWithNSString:[((id<ImplUiElement>) nil_chk([((id<ViewAddActionView>) view_) getTargetUiElement])) getValue]];
  [action setDeadlineWithJavaUtilDate:[((id<ImplUiElement>) nil_chk([((id<ViewAddActionView>) view_) getDeadlineUiElement])) getValue]];
  [action setDescriptionWithNSString:[((id<ImplUiElement>) nil_chk([((id<ViewAddActionView>) view_) getDescriptionUiElement])) getValue]];
  [action setStatusWithModelAction_StatusEnum:[((id<ImplUiDropdown>) nil_chk([((id<ViewAddActionView>) view_) getStatusUiElement])) getValue]];
  [action setUnitWithModelUnit:[((JavaUtilArrayList *) nil_chk(units_)) getWithInt:[((id<ImplUiDropdown>) nil_chk([((id<ViewAddActionView>) view_) getUnitUiElement])) getSelectedIndex]]];
  ServiceService_updateOrSaveActionsWithModelAction_(action);
  [((id<ViewAddActionView>) view_) closeDialog];
}

- (void)onUnitsFetchedWithEventFetchUnitsEvent:(EventFetchUnitsEvent *)event {
  [((id<ImplUiDropdown>) nil_chk([((id<ViewAddActionView>) nil_chk(view_)) getUnitUiElement])) setArrayWithNSObjectArray:[((ComGoogleCommonCollectImmutableSet *) nil_chk([((EventFetchUnitsEvent *) nil_chk(event)) getUnits])) toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((ComGoogleCommonCollectImmutableSet *) nil_chk([event getUnits])) size] type:ModelUnit_class_()]]];
}

- (void)onStop {
  [super onStop];
  EventEvent_unsubscribeWithEventEventType_withEventEventHandler_(JreLoadStatic(EventFetchUnitsEvent, TYPE_), self);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithViewAddActionView:", "AddActionController", NULL, 0x1, NULL, NULL },
    { "getTitle", NULL, "Ljava.lang.String;", 0x0, NULL, NULL },
    { "addAction", NULL, "V", 0x1, NULL, NULL },
    { "onUnitsFetchedWithEventFetchUnitsEvent:", "onUnitsFetched", "V", 0x1, NULL, NULL },
    { "onStop", NULL, "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "units_", NULL, 0x2, "Ljava.util.ArrayList;", NULL, "Ljava/util/ArrayList<Lrtdc/core/model/Unit;>;", .constantValue.asLong = 0 },
    { "currentAction_", NULL, 0x2, "Lrtdc.core.model.Action;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"Lrtdc.core.view.AddActionView;"};
  static const J2ObjcClassInfo _ControllerAddActionController = { 2, "AddActionController", "rtdc.core.controller", NULL, 0x1, 5, methods, 2, fields, 1, superclass_type_args, 0, NULL, NULL, "Lrtdc/core/controller/Controller<Lrtdc/core/view/AddActionView;>;Lrtdc/core/event/FetchUnitsEvent$Handler;" };
  return &_ControllerAddActionController;
}

@end

void ControllerAddActionController_initWithViewAddActionView_(ControllerAddActionController *self, id<ViewAddActionView> view) {
  (void) ControllerController_initWithViewView_(self, view);
  self->units_ = new_JavaUtilArrayList_init();
  EventEvent_subscribeWithEventEventType_withEventEventHandler_(JreLoadStatic(EventFetchUnitsEvent, TYPE_), self);
  ServiceService_getUnits();
  [((id<ImplUiDropdown>) nil_chk([((id<ViewAddActionView>) nil_chk(view)) getTaskUiElement])) setArrayWithNSObjectArray:ModelAction_TaskEnum_values()];
  [((id<ImplUiDropdown>) nil_chk([view getTaskUiElement])) setStringifierWithUtilStringifier:ModelAction_TaskEnum_getStringifier()];
  [((id<ImplUiDropdown>) nil_chk([view getStatusUiElement])) setArrayWithNSObjectArray:ModelAction_StatusEnum_values()];
  [((id<ImplUiDropdown>) nil_chk([view getStatusUiElement])) setStringifierWithUtilStringifier:ModelAction_StatusEnum_getStringifier()];
  [((id<ImplUiDropdown>) nil_chk([view getUnitUiElement])) setStringifierWithUtilStringifier:new_ControllerAddActionController_$1_init()];
  self->currentAction_ = (ModelAction *) check_class_cast([((UtilCache *) nil_chk(UtilCache_getInstance())) retrieveWithNSString:@"action"], [ModelAction class]);
  if (self->currentAction_ != nil) {
    [view setTitleWithNSString:@"Edit Action"];
    [((id<ImplUiElement>) nil_chk([view getRoleUiElement])) setValueWithId:[self->currentAction_ getRoleResponsible]];
    [((id<ImplUiElement>) nil_chk([view getTargetUiElement])) setValueWithId:[self->currentAction_ getTarget]];
    [((id<ImplUiElement>) nil_chk([view getDeadlineUiElement])) setValueWithId:[self->currentAction_ getDeadline]];
    [((id<ImplUiElement>) nil_chk([view getDescriptionUiElement])) setValueWithId:[self->currentAction_ getDescription]];
    [((id<ImplUiDropdown>) nil_chk([view getUnitUiElement])) setValueWithId:[self->currentAction_ getUnit]];
    [((id<ImplUiDropdown>) nil_chk([view getStatusUiElement])) setValueWithId:[self->currentAction_ getStatus]];
    [((id<ImplUiDropdown>) nil_chk([view getTaskUiElement])) setValueWithId:[self->currentAction_ getTask]];
  }
}

ControllerAddActionController *new_ControllerAddActionController_initWithViewAddActionView_(id<ViewAddActionView> view) {
  ControllerAddActionController *self = [ControllerAddActionController alloc];
  ControllerAddActionController_initWithViewAddActionView_(self, view);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ControllerAddActionController)

@implementation ControllerAddActionController_$1

- (NSString *)toStringWithId:(ModelUnit *)unit {
  return unit == nil ? @"" : [unit getName];
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ControllerAddActionController_$1_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "toStringWithId:", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "init", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "ControllerAddActionController", "initWithViewAddActionView:" };
  static const J2ObjcClassInfo _ControllerAddActionController_$1 = { 2, "", "rtdc.core.controller", "AddActionController", 0x8008, 2, methods, 0, NULL, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Lrtdc/core/util/Stringifier<Lrtdc/core/model/Unit;>;" };
  return &_ControllerAddActionController_$1;
}

@end

void ControllerAddActionController_$1_init(ControllerAddActionController_$1 *self) {
  (void) NSObject_init(self);
}

ControllerAddActionController_$1 *new_ControllerAddActionController_$1_init() {
  ControllerAddActionController_$1 *self = [ControllerAddActionController_$1 alloc];
  ControllerAddActionController_$1_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ControllerAddActionController_$1)
