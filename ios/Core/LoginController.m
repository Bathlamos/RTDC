//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/nicolasmenard/IdeaProjects/RTDC/core/src/main/java/rtdc/core/controller/LoginController.java
//

#include "AuthenticationEvent.h"
#include "Bootstrapper.h"
#include "Controller.h"
#include "Dispatcher.h"
#include "Event.h"
#include "EventType.h"
#include "Factory.h"
#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "LoginController.h"
#include "LoginView.h"
#include "Service.h"
#include "Session.h"
#include "Storage.h"
#include "UiElement.h"
#include "User.h"
#include "VoipController.h"
#include "java/util/logging/Level.h"
#include "java/util/logging/Logger.h"

static JavaUtilLoggingLogger *ControllerLoginController_logger_;
J2OBJC_STATIC_FIELD_GETTER(ControllerLoginController, logger_, JavaUtilLoggingLogger *)

J2OBJC_INITIALIZED_DEFN(ControllerLoginController)

@implementation ControllerLoginController

- (instancetype)initWithViewLoginView:(id<ViewLoginView>)view {
  ControllerLoginController_initWithViewLoginView_(self, view);
  return self;
}

- (NSString *)getTitle {
  return @"Login";
}

- (void)login {
  [((JavaUtilLoggingLogger *) nil_chk(ControllerLoginController_logger_)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, INFO_) withNSString:@"Subscribing to AuthenticationEvent"];
  EventEvent_subscribeWithEventEventType_withEventEventHandler_(JreLoadStatic(EventAuthenticationEvent, TYPE_), self);
  NSString *username = [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) nil_chk(view_)) getUsernameUiElement])) getValue];
  NSString *password = [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) view_) getPasswordUiElement])) getValue];
  if ([((NSString *) nil_chk(username)) isEmpty]) {
    [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) view_) getUsernameUiElement])) setErrorMessageWithNSString:@"Username cannot be empty"];
    [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) view_) getUsernameUiElement])) setFocusWithBoolean:true];
  }
  else if ([((NSString *) nil_chk(password)) isEmpty]) {
    [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) view_) getPasswordUiElement])) setErrorMessageWithNSString:@"Password cannot be empty"];
    [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) view_) getPasswordUiElement])) setFocusWithBoolean:true];
  }
  else ServiceService_authenticateUserWithNSString_withNSString_(username, password);
}

- (void)onAuthenticateWithEventAuthenticationEvent:(EventAuthenticationEvent *)event {
  [((JavaUtilLoggingLogger *) nil_chk(ControllerLoginController_logger_)) logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, INFO_) withNSString:@"AuthenticationEvent received"];
  *JreLoadStaticRef(RtdcCoreBootstrapper, AUTHENTICATION_TOKEN_) = [((EventAuthenticationEvent *) nil_chk(event)) getAuthenticationToken];
  [((id<ImplStorage>) nil_chk([((id<ImplFactory>) nil_chk(JreLoadStatic(RtdcCoreBootstrapper, FACTORY_))) getStorage])) addWithNSString:ImplStorage_KEY_AUTH_TOKEN_ withNSString:JreLoadStatic(RtdcCoreBootstrapper, AUTHENTICATION_TOKEN_)];
  RtdcCoreSession_setCurrentSessionWithRtdcCoreSession_(new_RtdcCoreSession_initWithModelUser_([event getUser]));
  [((id<ImplVoipController>) nil_chk([JreLoadStatic(RtdcCoreBootstrapper, FACTORY_) getVoipController])) registerUserWithModelUser:[event getUser]];
  EventEvent_unsubscribeWithEventEventType_withEventEventHandler_(JreLoadStatic(EventAuthenticationEvent, TYPE_), self);
  [((id<ImplDispatcher>) nil_chk([JreLoadStatic(RtdcCoreBootstrapper, FACTORY_) newDispatcher])) goToAllUnitsWithControllerController:self];
}

- (void)onStop {
  [super onStop];
  EventEvent_unsubscribeWithEventEventType_withEventEventHandler_(JreLoadStatic(EventAuthenticationEvent, TYPE_), self);
}

+ (void)initialize {
  if (self == [ControllerLoginController class]) {
    ControllerLoginController_logger_ = JavaUtilLoggingLogger_getLoggerWithNSString_([ControllerLoginController_class_() getCanonicalName]);
    J2OBJC_SET_INITIALIZED(ControllerLoginController)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithViewLoginView:", "LoginController", NULL, 0x1, NULL, NULL },
    { "getTitle", NULL, "Ljava.lang.String;", 0x0, NULL, NULL },
    { "login", NULL, "V", 0x1, NULL, NULL },
    { "onAuthenticateWithEventAuthenticationEvent:", "onAuthenticate", "V", 0x1, NULL, NULL },
    { "onStop", NULL, "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "logger_", NULL, 0x1a, "Ljava.util.logging.Logger;", &ControllerLoginController_logger_, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"Lrtdc.core.view.LoginView;"};
  static const J2ObjcClassInfo _ControllerLoginController = { 2, "LoginController", "rtdc.core.controller", NULL, 0x1, 5, methods, 1, fields, 1, superclass_type_args, 0, NULL, NULL, "Lrtdc/core/controller/Controller<Lrtdc/core/view/LoginView;>;Lrtdc/core/event/AuthenticationEvent$Handler;Lrtdc/core/event/ErrorEvent$Handler;" };
  return &_ControllerLoginController;
}

@end

void ControllerLoginController_initWithViewLoginView_(ControllerLoginController *self, id<ViewLoginView> view) {
  (void) ControllerController_initWithViewView_(self, view);
  [((id<ImplUiElement>) nil_chk([((id<ViewLoginView>) nil_chk(view)) getUsernameUiElement])) setFocusWithBoolean:true];
}

ControllerLoginController *new_ControllerLoginController_initWithViewLoginView_(id<ViewLoginView> view) {
  ControllerLoginController *self = [ControllerLoginController alloc];
  ControllerLoginController_initWithViewLoginView_(self, view);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ControllerLoginController)
